# 订单售后流程与客户联动系统 - 详细设计方案

**作者：** MiniMax Agent  
**日期：** 2025-07-17

## 系统概述

设计一个完整的订单售后管理系统，包括返修、退款、换机等全流程管理，与客户管理系统深度联动，提供360度客户视图和完整的历史记录追踪。

## 🔄 售后流程管理系统

### 1. 返修流程管理

#### 1.1 返修申请与受理
```typescript
interface RepairReturnProcess {
  // 返修申请
  returnRequest: {
    requestId: string;
    originalOrderId: string;
    customerId: string;
    
    // 申请基础信息
    requestInfo: {
      requestDate: Date;
      requestChannel: 'phone' | 'online' | 'in_store' | 'email' | 'wechat';
      requestReason: 'quality_issue' | 'not_working' | 'incomplete_repair' | 'new_damage' | 'customer_dissatisfaction' | 'other';
      detailedReason: string;
      urgency: 'low' | 'normal' | 'high' | 'urgent';
    };
    
    // 设备状态
    deviceCondition: {
      powerOn: boolean;
      physicalDamage: string[];
      functionalIssues: string[];
      accessories: string[];
      originalPackaging: boolean;
      customerDescription: string;
      photos: string[]; // 客户提供的照片
    };
    
    // 原始维修信息
    originalRepair: {
      repairDate: Date;
      technicianId: string;
      repairType: string;
      partsReplaced: string[];
      warrantyPeriod: number; // 天数
      warrantyExpiry: Date;
      repairCost: number;
    };
    
    // 返修请求状态
    status: 'submitted' | 'under_review' | 'approved' | 'rejected' | 'in_progress' | 'completed' | 'cancelled';
    reviewNotes: string;
    approvedBy?: string;
    approvalDate?: Date;
  };
  
  // 返修处理流程
  returnProcessing: {
    // 初步检查
    initialInspection: {
      inspectionDate: Date;
      inspectorId: string;
      
      findings: {
        issueConfirmed: boolean;
        rootCause: string;
        responsibility: 'technician_error' | 'part_defect' | 'customer_damage' | 'normal_wear' | 'design_flaw';
        repairability: 'repairable' | 'not_repairable' | 'requires_replacement';
        estimatedCost: number;
        estimatedTime: number; // 小时
      };
      
      recommendations: {
        action: 'free_repair' | 'paid_repair' | 'replacement' | 'refund' | 'reject';
        reason: string;
        alternativeOptions: string[];
      };
      
      photos: string[];
      notes: string;
    };
    
    // 客户沟通
    customerCommunication: {
      communicationLog: Array<{
        timestamp: Date;
        channel: string;
        direction: 'inbound' | 'outbound';
        content: string;
        staffId: string;
        customerResponse?: string;
        followUpRequired: boolean;
      }>;
      
      resolutionProposal: {
        proposedSolution: string;
        cost: number;
        timeline: string;
        terms: string[];
        customerAgreement: boolean;
        agreementDate?: Date;
        signedDocument?: string;
      };
    };
    
    // 返修执行
    repairExecution: {
      assignedTechnician: string;
      startDate: Date;
      
      repairSteps: Array<{
        stepId: string;
        description: string;
        startTime: Date;
        endTime?: Date;
        status: 'pending' | 'in_progress' | 'completed' | 'blocked';
        notes: string;
        photos: string[];
        partsUsed: Array<{
          partId: string;
          quantity: number;
          cost: number;
        }>;
      }>;
      
      qualityCheck: {
        checkDate: Date;
        checkerId: string;
        testResults: Record<string, boolean>;
        overallResult: 'pass' | 'fail';
        notes: string;
        retestRequired: boolean;
      };
      
      completionDate?: Date;
      totalCost: number;
      newWarrantyPeriod: number;
    };
  };
}
```

#### 1.2 质量责任认定
```typescript
interface QualityLiabilityAssessment {
  // 责任分析
  liabilityAnalysis: {
    analysisId: string;
    orderId: string;
    returnRequestId: string;
    
    // 时间线分析
    timeline: {
      originalRepairDate: Date;
      warrantyPeriod: number;
      issueReportedDate: Date;
      daysSinceRepair: number;
      withinWarranty: boolean;
    };
    
    // 技术分析
    technicalAnalysis: {
      originalIssue: string;
      currentIssue: string;
      isRelatedIssue: boolean;
      rootCauseAnalysis: {
        primaryCause: string;
        contributingFactors: string[];
        preventability: 'preventable' | 'not_preventable' | 'unclear';
      };
      
      workmanshipQuality: {
        rating: number; // 1-10
        issues: string[];
        photos: string[];
      };
      
      partQuality: {
        rating: number;
        defectType: string;
        supplierInfo: string;
        batchInfo: string;
      };
    };
    
    // 责任分配
    liabilityDistribution: {
      technician: number; // 百分比
      supplier: number;
      customer: number;
      systemicIssue: number;
      other: number;
      
      justification: string;
      evidence: string[];
      reviewedBy: string;
      reviewDate: Date;
    };
    
    // 成本承担
    costDistribution: {
      companyBear: number;
      customerPay: number;
      supplierClaim: number;
      insuranceClaim: number;
      
      breakdown: {
        laborCost: number;
        partsCost: number;
        shippingCost: number;
        compensationCost: number;
      };
    };
  };
  
  // 预防措施
  preventiveMeasures: {
    processImprovement: string[];
    trainingNeeds: string[];
    supplierActions: string[];
    qualityControls: string[];
    systemUpdates: string[];
  };
}
```

### 2. 退款流程管理

#### 2.1 退款申请处理
```typescript
interface RefundProcess {
  // 退款申请
  refundRequest: {
    refundId: string;
    orderId: string;
    customerId: string;
    
    // 申请信息
    requestInfo: {
      requestDate: Date;
      requestReason: 'not_repairable' | 'customer_dissatisfaction' | 'service_failure' | 'cancelled_order' | 'duplicate_payment' | 'other';
      detailedReason: string;
      requestedAmount: number;
      originalPaymentMethod: string;
      supportingDocuments: string[];
    };
    
    // 订单信息
    orderInfo: {
      orderDate: Date;
      totalAmount: number;
      paidAmount: number;
      serviceCompleted: boolean;
      completionDate?: Date;
      warranty: {
        covered: boolean;
        period: number;
        expired: boolean;
      };
    };
    
    // 退款计算
    refundCalculation: {
      eligibleAmount: number;
      deductions: Array<{
        type: 'usage_fee' | 'restocking_fee' | 'inspection_fee' | 'processing_fee';
        amount: number;
        reason: string;
      }>;
      netRefundAmount: number;
      taxRefund: number;
      finalAmount: number;
    };
    
    status: 'submitted' | 'under_review' | 'approved' | 'rejected' | 'processing' | 'completed' | 'cancelled';
  };
  
  // 退款审批流程
  approvalWorkflow: {
    approvalSteps: Array<{
      stepId: string;
      stepName: string;
      approverRole: string;
      approverName?: string;
      
      // 审批阈值
      thresholds: {
        maxAmount: number;
        timeLimit: number; // 小时
        autoApproval: boolean;
      };
      
      // 审批决定
      decision: {
        approved: boolean;
        timestamp?: Date;
        comments: string;
        conditions: string[];
        nextStep?: string;
      };
    }>;
    
    currentStep: number;
    overallStatus: 'pending' | 'approved' | 'rejected' | 'escalated';
    finalApprover: string;
    finalDecisionDate?: Date;
  };
  
  // 退款执行
  refundExecution: {
    paymentProcessor: string;
    processingMethod: 'original_method' | 'bank_transfer' | 'check' | 'cash' | 'store_credit';
    
    processingSteps: Array<{
      step: string;
      status: 'pending' | 'processing' | 'completed' | 'failed';
      timestamp?: Date;
      transactionId?: string;
      errorMessage?: string;
    }>;
    
    completionInfo: {
      processedDate?: Date;
      transactionReference: string;
      actualAmount: number;
      processingFee: number;
      customerNotified: boolean;
      confirmationSent: boolean;
    };
  };
}
```

#### 2.2 退款政策引擎
```typescript
interface RefundPolicyEngine {
  // 政策规则
  policyRules: {
    timeBasedRules: Array<{
      ruleId: string;
      description: string;
      timeframe: number; // 天数
      conditions: string[];
      refundPercentage: number;
      applicableServices: string[];
    }>;
    
    conditionBasedRules: Array<{
      ruleId: string;
      condition: string;
      refundEligibility: boolean;
      refundPercentage: number;
      additionalFees: Array<{
        type: string;
        amount: number;
        calculation: 'fixed' | 'percentage';
      }>;
    }>;
    
    customerTierRules: Array<{
      customerTier: string;
      benefits: {
        extendedPeriod: number;
        waiveFees: string[];
        priorityProcessing: boolean;
        expeditedRefund: boolean;
      };
    }>;
  };
  
  // 自动计算引擎
  calculationEngine: {
    baseRefundCalculation: (order: any, reason: string) => RefundCalculation;
    deductionCalculation: (order: any, usage: any) => DeductionBreakdown;
    eligibilityCheck: (order: any, customer: any, reason: string) => EligibilityResult;
    
    specialCases: Array<{
      caseName: string;
      condition: string;
      calculation: string;
      approvalRequired: boolean;
    }>;
  };
}
```

### 3. 换机服务流程

#### 3.1 设备置换管理
```typescript
interface DeviceExchangeProcess {
  // 换机申请
  exchangeRequest: {
    exchangeId: string;
    originalOrderId: string;
    customerId: string;
    
    // 换机信息
    exchangeInfo: {
      reason: 'unrepairable' | 'upgrade_request' | 'compatibility_issue' | 'customer_preference' | 'stock_unavailable';
      originalDevice: {
        brand: string;
        model: string;
        condition: string;
        estimatedValue: number;
      };
      
      requestedDevice: {
        brand: string;
        model: string;
        newDevice: boolean;
        estimatedCost: number;
      };
      
      priceDifference: number;
      customerPayment: number;
      companyCompensation: number;
    };
    
    // 设备评估
    deviceAssessment: {
      assessmentDate: Date;
      assessorId: string;
      
      originalDeviceValue: {
        marketValue: number;
        conditionAdjustment: number;
        ageAdjustment: number;
        finalValue: number;
        
        assessment: {
          screen: { condition: string; impact: number };
          battery: { condition: string; impact: number };
          camera: { condition: string; impact: number };
          speakers: { condition: string; impact: number };
          microphone: { condition: string; impact: number };
          charging: { condition: string; impact: number };
          physical: { condition: string; impact: number };
        };
      };
      
      replacementDeviceValue: {
        retailPrice: number;
        wholesalePrice: number;
        customerPrice: number;
        warrantyPeriod: number;
      };
      
      netExchangeCost: number;
      recommendedAction: 'approve' | 'negotiate' | 'reject';
    };
  };
  
  // 库存协调
  inventoryCoordination: {
    availability: {
      inStock: boolean;
      quantity: number;
      location: string;
      reservationId?: string;
      expectedArrival?: Date;
    };
    
    alternativeOptions: Array<{
      device: string;
      availability: boolean;
      priceDifference: number;
      customerBenefit: string;
    }>;
    
    expeditedDelivery: {
      available: boolean;
      additionalCost: number;
      timeframe: string;
    };
  };
  
  // 数据迁移服务
  dataMigration: {
    required: boolean;
    serviceIncluded: boolean;
    additionalCost: number;
    
    migrationPlan: {
      dataTypes: string[];
      estimatedTime: number;
      specialRequirements: string[];
      backupRequired: boolean;
    };
    
    migrationExecution: {
      startTime?: Date;
      endTime?: Date;
      status: 'pending' | 'in_progress' | 'completed' | 'failed';
      technicianId?: string;
      issues: string[];
      customerVerification: boolean;
    };
  };
}
```

## 👥 客户管理深度联动

### 1. 360度客户视图

#### 1.1 客户全景信息
```typescript
interface Customer360View {
  // 客户基础档案
  customerProfile: {
    basicInfo: {
      customerId: string;
      name: string;
      phone: string;
      email: string;
      registrationDate: Date;
      lastContactDate: Date;
      preferredContactMethod: string;
      vipLevel: 'bronze' | 'silver' | 'gold' | 'platinum' | 'diamond';
    };
    
    demographicInfo: {
      age: number;
      gender: string;
      location: string;
      occupation: string;
      incomeLevel: string;
      education: string;
    };
    
    behaviorProfile: {
      devicePreference: string[];
      brandLoyalty: Record<string, number>;
      priceThreshold: {
        low: number;
        high: number;
        average: number;
      };
      servicePreferences: string[];
      communicationStyle: string;
    };
  };
  
  // 订单历史汇总
  orderHistory: {
    summary: {
      totalOrders: number;
      totalSpent: number;
      averageOrderValue: number;
      firstOrderDate: Date;
      lastOrderDate: Date;
      orderFrequency: number; // 天数
    };
    
    patterns: {
      seasonalPatterns: Record<string, number>;
      deviceTypePatterns: Record<string, number>;
      serviceTypePatterns: Record<string, number>;
      urgencyPatterns: Record<string, number>;
    };
    
    lifecycle: {
      customerAge: number; // 天数
      lifetimeValue: number;
      predictedFutureValue: number;
      churnRisk: number; // 0-1
      nextOrderPrediction: Date;
    };
  };
  
  // 服务历史详情
  serviceHistory: {
    repairHistory: Array<{
      orderId: string;
      date: Date;
      device: string;
      issue: string;
      resolution: string;
      satisfaction: number;
      cost: number;
      warranty: string;
      followUp: boolean;
    }>;
    
    returnHistory: Array<{
      returnId: string;
      originalOrderId: string;
      reason: string;
      resolution: string;
      cost: number;
      customerSatisfaction: number;
    }>;
    
    complaintsHistory: Array<{
      complaintId: string;
      date: Date;
      category: string;
      description: string;
      resolution: string;
      resolutionTime: number; // 小时
      satisfaction: number;
    }>;
  };
  
  // 设备档案
  devicePortfolio: Array<{
    deviceId: string;
    brand: string;
    model: string;
    purchaseDate: Date;
    warrantyStatus: string;
    
    serviceHistory: Array<{
      date: Date;
      serviceType: string;
      issue: string;
      cost: number;
      technician: string;
    }>;
    
    healthScore: number;
    replacementRecommendation: {
      recommended: boolean;
      reason: string;
      suggestedDevice: string;
      estimatedCost: number;
    };
  }>;
  
  // 财务状况
  financialProfile: {
    creditInfo: {
      creditScore: number;
      paymentHistory: {
        onTimePayments: number;
        latePayments: number;
        averagePaymentDelay: number;
      };
      outstandingBalance: number;
      creditLimit: number;
    };
    
    profitability: {
      totalRevenue: number;
      totalCost: number;
      netProfit: number;
      profitMargin: number;
      profitabilityRank: number;
    };
    
    riskAssessment: {
      paymentRisk: 'low' | 'medium' | 'high';
      collectionRisk: number;
      recommendedCreditLimit: number;
      specialTerms: string[];
    };
  };
}
```

#### 1.2 客户智能洞察
```typescript
interface CustomerIntelligence {
  // 行为分析
  behaviorAnalysis: {
    usagePatterns: {
      sessionFrequency: number;
      averageSessionDuration: number;
      peakUsageHours: string[];
      channelPreferences: Record<string, number>;
    };
    
    purchasePatterns: {
      decisionTime: number; // 从咨询到下单的平均时间
      priceComparisionBehavior: boolean;
      influencingFactors: string[];
      seasonalInfluence: Record<string, number>;
    };
    
    servicePatterns: {
      preferredTechnicians: string[];
      communicationFrequency: number;
      followUpResponse: number;
      satisfactionDrivers: string[];
    };
  };
  
  // 预测分析
  predictiveAnalytics: {
    churnPrediction: {
      churnProbability: number;
      churnRiskFactors: string[];
      retentionRecommendations: string[];
      interventionTiming: Date;
    };
    
    valueGrowthPrediction: {
      sixMonthProjection: number;
      oneYearProjection: number;
      growthPotential: 'high' | 'medium' | 'low';
      growthDrivers: string[];
    };
    
    nextServicePrediction: {
      likelyServiceDate: Date;
      likelyServiceType: string;
      estimatedValue: number;
      confidence: number;
    };
    
    upsellOpportunities: Array<{
      product: string;
      probability: number;
      estimatedValue: number;
      recommendedTiming: Date;
      approach: string;
    }>;
  };
  
  // 个性化推荐
  personalization: {
    serviceRecommendations: Array<{
      service: string;
      relevanceScore: number;
      timing: string;
      approach: string;
      expectedResponse: number;
    }>;
    
    communicationPersonalization: {
      preferredTone: string;
      optimalContactTime: string;
      effectiveChannels: string[];
      messageFrequency: string;
    };
    
    offerPersonalization: {
      priceThreshold: number;
      discountSensitivity: number;
      valueDrivers: string[];
      bundlePreferences: string[];
    };
  };
}
```

### 2. 历史记录管理

#### 2.1 完整交互历史
```typescript
interface InteractionHistory {
  // 沟通记录
  communicationLog: Array<{
    recordId: string;
    timestamp: Date;
    channel: 'phone' | 'email' | 'sms' | 'wechat' | 'in_person' | 'online_chat';
    direction: 'inbound' | 'outbound';
    
    // 沟通内容
    content: {
      subject: string;
      summary: string;
      fullContent: string;
      attachments: string[];
      tags: string[];
    };
    
    // 参与人员
    participants: {
      customer: boolean;
      staff: Array<{
        staffId: string;
        name: string;
        role: string;
        department: string;
      }>;
    };
    
    // 沟通结果
    outcome: {
      category: 'inquiry' | 'complaint' | 'compliment' | 'service_request' | 'follow_up' | 'support';
      resolution: 'resolved' | 'pending' | 'escalated' | 'referred';
      nextAction: string;
      followUpRequired: boolean;
      followUpDate?: Date;
      satisfaction?: number;
    };
    
    // 关联信息
    relatedOrders: string[];
    relatedIssues: string[];
    contextTags: string[];
  }>;
  
  // 服务事件记录
  serviceEvents: Array<{
    eventId: string;
    eventType: 'order_created' | 'service_started' | 'issue_reported' | 'complaint_filed' | 'payment_made' | 'warranty_claimed';
    timestamp: Date;
    orderId?: string;
    
    eventDetails: {
      description: string;
      location: string;
      staffInvolved: string[];
      systemGenerated: boolean;
      customerTriggered: boolean;
    };
    
    businessImpact: {
      financialImpact: number;
      satisfactionImpact: number;
      operationalImpact: string;
      riskLevel: 'low' | 'medium' | 'high';
    };
    
    resolution: {
      resolved: boolean;
      resolutionTime?: number; // 小时
      resolutionCost?: number;
      customerSatisfaction?: number;
    };
  }>;
  
  // 系统交互记录
  systemInteractions: Array<{
    sessionId: string;
    startTime: Date;
    endTime: Date;
    device: string;
    browser: string;
    ipAddress: string;
    location: string;
    
    activities: Array<{
      timestamp: Date;
      action: string;
      page: string;
      duration: number;
      successful: boolean;
    }>;
    
    goals: {
      achieved: string[];
      abandoned: string[];
      assistanceRequired: boolean;
    };
  }>;
}
```

#### 2.2 智能搜索和过滤
```typescript
interface HistorySearchAndFilter {
  // 高级搜索
  advancedSearch: {
    // 文本搜索
    textSearch: {
      query: string;
      searchFields: string[];
      fuzzyMatch: boolean;
      synonyms: boolean;
      stemming: boolean;
    };
    
    // 时间过滤
    timeFilter: {
      startDate?: Date;
      endDate?: Date;
      relativePeriod?: '7d' | '30d' | '90d' | '1y';
      timeGranularity: 'day' | 'week' | 'month' | 'quarter';
    };
    
    // 分类过滤
    categoryFilter: {
      eventTypes: string[];
      channels: string[];
      staffMembers: string[];
      orderStatus: string[];
      satisfactionRange: { min: number; max: number };
    };
    
    // 自定义过滤器
    customFilters: Array<{
      field: string;
      operator: 'equals' | 'contains' | 'greater_than' | 'less_than' | 'between';
      value: any;
    }>;
  };
  
  // 智能标签系统
  intelligentTagging: {
    automaticTags: {
      sentiment: 'positive' | 'neutral' | 'negative';
      urgency: 'low' | 'medium' | 'high';
      complexity: 'simple' | 'moderate' | 'complex';
      category: string[];
    };
    
    manualTags: string[];
    
    suggestedTags: Array<{
      tag: string;
      confidence: number;
      reason: string;
    }>;
  };
  
  // 导出和报告
  exportOptions: {
    formats: ['pdf', 'excel', 'csv', 'json'];
    customReports: Array<{
      reportName: string;
      template: string;
      parameters: Record<string, any>;
    }>;
    
    scheduledExports: Array<{
      schedule: string;
      recipients: string[];
      format: string;
      filters: any;
    }>;
  };
}
```

## 📊 订单详情管理

### 1. 订单详情增强视图

#### 1.1 多维度订单信息
```typescript
interface EnhancedOrderDetails {
  // 基础订单信息
  orderBasics: {
    orderNumber: string;
    status: string;
    priority: string;
    createdDate: Date;
    lastUpdated: Date;
    estimatedCompletion: Date;
    actualCompletion?: Date;
  };
  
  // 客户信息快照
  customerSnapshot: {
    customerId: string;
    name: string;
    phone: string;
    email: string;
    vipLevel: string;
    orderHistory: {
      totalOrders: number;
      totalSpent: number;
      lastOrder: Date;
    };
    riskProfile: string;
  };
  
  // 设备详细信息
  deviceDetails: {
    basicInfo: {
      brand: string;
      model: string;
      color: string;
      storage: string;
      imei: string;
      serialNumber: string;
    };
    
    conditionAssessment: {
      initialCondition: string;
      photos: string[];
      functionalTests: Record<string, boolean>;
      physicalDamage: string[];
      accessories: string[];
    };
    
    historyLookup: {
      previousRepairs: Array<{
        date: Date;
        provider: string;
        type: string;
        warranty: string;
      }>;
      
      recallInformation: Array<{
        recallId: string;
        description: string;
        severity: string;
        actions: string[];
      }>;
      
      marketInfo: {
        currentValue: number;
        originalPrice: number;
        commonIssues: string[];
        repairability: string;
      };
    };
  };
  
  // 问题诊断信息
  diagnosisDetails: {
    reportedIssues: {
      customerDescription: string;
      symptoms: string[];
      circumstances: string;
      frequency: string;
      impact: string;
    };
    
    technicalDiagnosis: {
      primaryIssue: string;
      secondaryIssues: string[];
      rootCause: string;
      diagnosticTests: Array<{
        test: string;
        result: boolean | string;
        notes: string;
      }>;
      
      repairStrategy: {
        approach: string;
        alternativeOptions: string[];
        riskAssessment: string;
        successProbability: number;
      };
    };
    
    photosAndEvidence: {
      beforePhotos: string[];
      diagnosticImages: string[];
      evidenceNotes: string[];
      customerAcknowledgment: boolean;
    };
  };
  
  // 维修执行详情
  repairExecution: {
    assignedTechnician: {
      technicianId: string;
      name: string;
      specialization: string[];
      experienceLevel: string;
      successRate: number;
    };
    
    workLog: Array<{
      timestamp: Date;
      action: string;
      description: string;
      duration: number;
      partsUsed: Array<{
        partId: string;
        partName: string;
        quantity: number;
        cost: number;
        supplier: string;
      }>;
      photos: string[];
      notes: string;
      qualityCheckpoint: boolean;
    }>;
    
    qualityControl: {
      intermediateChecks: Array<{
        checkpoint: string;
        timestamp: Date;
        result: boolean;
        notes: string;
        correctionRequired: boolean;
      }>;
      
      finalInspection: {
        inspector: string;
        inspectionDate: Date;
        testResults: Record<string, boolean>;
        overallResult: 'pass' | 'fail' | 'conditional';
        notes: string;
        customerDemonstration: boolean;
      };
    };
  };
  
  // 财务详情
  financialDetails: {
    costBreakdown: {
      diagnosticFee: number;
      laborCost: number;
      partsCost: Array<{
        partName: string;
        quantity: number;
        unitCost: number;
        totalCost: number;
        markup: number;
      }>;
      additionalServices: Array<{
        service: string;
        cost: number;
        description: string;
      }>;
      taxes: number;
      discounts: Array<{
        type: string;
        amount: number;
        reason: string;
      }>;
      totalCost: number;
    };
    
    paymentHistory: Array<{
      paymentId: string;
      timestamp: Date;
      amount: number;
      method: string;
      status: string;
      transactionId: string;
      refundable: boolean;
    }>;
    
    financialStatus: {
      totalDue: number;
      totalPaid: number;
      balance: number;
      paymentStatus: 'pending' | 'partial' | 'complete' | 'overdue';
      creditApplied: number;
    };
  };
  
  // 保修信息
  warrantyInfo: {
    warrantyPeriod: number; // 天数
    warrantyStartDate: Date;
    warrantyEndDate: Date;
    warrantyTerms: string[];
    
    coverage: {
      partsWarranty: Record<string, number>;
      laborWarranty: number;
      exclusions: string[];
      transferable: boolean;
    };
    
    claims: Array<{
      claimId: string;
      claimDate: Date;
      issue: string;
      status: string;
      resolution: string;
      cost: number;
    }>;
  };
}
```

#### 1.2 订单时间线可视化
```typescript
interface OrderTimeline {
  // 时间线事件
  timelineEvents: Array<{
    eventId: string;
    timestamp: Date;
    eventType: 'milestone' | 'action' | 'communication' | 'issue' | 'payment';
    
    eventDetails: {
      title: string;
      description: string;
      icon: string;
      color: string;
      importance: 'low' | 'medium' | 'high';
    };
    
    participants: Array<{
      type: 'customer' | 'technician' | 'manager' | 'system';
      name: string;
      role: string;
    }>;
    
    outcomes: {
      successful: boolean;
      impact: string;
      nextSteps: string[];
      followUpRequired: boolean;
    };
    
    attachments: string[];
    relatedEvents: string[];
  }>;
  
  // 里程碑追踪
  milestones: Array<{
    milestone: string;
    plannedDate: Date;
    actualDate?: Date;
    status: 'upcoming' | 'current' | 'completed' | 'overdue' | 'skipped';
    dependencies: string[];
    criticalPath: boolean;
  }>;
  
  // 延期分析
  delayAnalysis: {
    totalDelay: number; // 小时
    delayReasons: Array<{
      reason: string;
      delay: number;
      responsible: string;
      preventable: boolean;
    }>;
    
    impactAssessment: {
      customerImpact: string;
      businessImpact: string;
      compensationRequired: boolean;
      estimatedCompensation: number;
    };
    
    preventionMeasures: string[];
  };
  
  // 预测分析
  predictions: {
    estimatedCompletion: Date;
    confidence: number;
    riskFactors: string[];
    contingencyPlans: string[];
  };
}
```

### 2. 智能关联分析

#### 2.1 订单关联网络
```typescript
interface OrderRelationshipAnalysis {
  // 直接关联
  directRelationships: {
    parentOrder?: string; // 原始订单（如果是返修）
    childOrders: string[]; // 衍生订单（返修、换机等）
    relatedOrders: string[]; // 相关订单（同一设备的其他维修）
    duplicateOrders: string[]; // 重复订单
  };
  
  // 客户关联
  customerRelationships: {
    customerOrders: Array<{
      orderId: string;
      date: Date;
      device: string;
      issue: string;
      status: string;
      similarity: number;
    }>;
    
    familyOrders: Array<{
      orderId: string;
      relationshipType: string;
      customerName: string;
      device: string;
    }>;
  };
  
  // 技术关联
  technicalRelationships: {
    similarIssues: Array<{
      orderId: string;
      device: string;
      issue: string;
      similarity: number;
      resolution: string;
      outcome: string;
    }>;
    
    commonPatterns: Array<{
      pattern: string;
      frequency: number;
      associatedOrders: string[];
      riskLevel: string;
    }>;
    
    deviceHistory: Array<{
      orderId: string;
      date: Date;
      technician: string;
      work: string;
      result: string;
    }>;
  };
  
  // 业务关联
  businessRelationships: {
    batchOrders: Array<{
      batchId: string;
      orders: string[];
      commonCharacteristics: string[];
      batchIssues: string[];
    }>;
    
    campaignOrders: Array<{
      campaignId: string;
      campaignType: string;
      orders: string[];
      performance: number;
    }>;
    
    seasonalPatterns: Array<{
      pattern: string;
      season: string;
      frequency: number;
      orders: string[];
    }>;
  };
}
```

## 🎛️ 管理界面设计

### 1. 客户360视图界面

#### 1.1 客户概览面板
```typescript
interface Customer360UI {
  // 主要信息卡片
  profileCards: {
    basicInfo: {
      layout: 'card';
      sections: ['contact', 'demographics', 'preferences'];
      editable: boolean;
      realTimeSync: boolean;
    };
    
    relationshipSummary: {
      layout: 'metrics';
      kpis: ['total_orders', 'total_spent', 'satisfaction', 'loyalty_score'];
      trendIndicators: boolean;
    };
    
    riskAndValue: {
      layout: 'gauge';
      metrics: ['customer_value', 'churn_risk', 'growth_potential'];
      alertThresholds: boolean;
    };
  };
  
  // 历史记录视图
  historyViews: {
    orderHistory: {
      layout: 'timeline' | 'table' | 'card';
      grouping: 'chronological' | 'device' | 'service_type';
      filtering: boolean;
      search: boolean;
      exportable: boolean;
    };
    
    communicationLog: {
      layout: 'chat' | 'log';
      channels: 'all' | 'specific';
      sentiment: boolean;
      threadedView: boolean;
    };
    
    serviceEvents: {
      layout: 'timeline';
      eventTypes: 'all' | 'filtered';
      impactVisualization: boolean;
      drillDown: boolean;
    };
  };
  
  // 智能洞察面板
  intelligencePanel: {
    predictions: {
      nextService: boolean;
      churnRisk: boolean;
      valueGrowth: boolean;
      upsellOpportunities: boolean;
    };
    
    recommendations: {
      retentionActions: boolean;
      crossSell: boolean;
      serviceUpgrade: boolean;
      communicationOptimization: boolean;
    };
    
    alerts: {
      riskAlerts: boolean;
      opportunityAlerts: boolean;
      serviceReminders: boolean;
      followUpRequired: boolean;
    };
  };
}
```

#### 1.2 订单详情界面
```typescript
interface OrderDetailsUI {
  // 订单头部信息
  orderHeader: {
    layout: 'header_bar';
    sections: ['status', 'priority', 'timeline', 'financial'];
    statusVisualization: 'progress_bar' | 'status_badges';
    quickActions: ['update_status', 'contact_customer', 'add_note', 'schedule_followup'];
  };
  
  // 主内容区域
  mainContent: {
    tabs: Array<{
      tabId: string;
      title: string;
      icon: string;
      content: string;
      lazyLoad: boolean;
    }>;
    
    defaultTab: string;
    tabPersistence: boolean;
  };
  
  // 侧边栏信息
  sidebar: {
    customerInfo: {
      compact: boolean;
      quickContact: boolean;
      historyPreview: boolean;
    };
    
    relatedOrders: {
      maxItems: number;
      grouping: 'device' | 'date' | 'type';
      quickView: boolean;
    };
    
    suggestions: {
      aiRecommendations: boolean;
      similarCases: boolean;
      troubleshooting: boolean;
    };
  };
  
  // 交互功能
  interactions: {
    inlineEditing: boolean;
    realTimeUpdates: boolean;
    commentSystem: boolean;
    photoAnnotation: boolean;
    documentGeneration: boolean;
    
    notifications: {
      statusChanges: boolean;
      customerMessages: boolean;
      systemAlerts: boolean;
      reminders: boolean;
    };
  };
}
```

这个订单售后流程与客户联动系统提供了：

✅ **完整售后流程** - 返修、退款、换机等全流程管理  
✅ **智能质量分析** - 责任认定和成本分配算法  
✅ **360度客户视图** - 全方位客户信息整合  
✅ **智能预测分析** - 客户行为和价值预测  
✅ **完整历史追踪** - 所有交互和服务记录  
✅ **关联分析** - 订单间的智能关联发现  

这套系统将大大提升客户管理的效率和质量，为业务决策提供强有力的数据支持！